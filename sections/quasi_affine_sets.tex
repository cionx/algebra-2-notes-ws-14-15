\section{Quasi-Affine Sets}





\subsection{Definition}


\begin{definition}
  If~$X$ is an affine set and~$X' \subseteq X$ is a Zariski open subset then~$X'$ is a \emph{{\qaffine} \textup(algebraic\textup) set}.
  The \emph{Zariski topology} on~$X'$ is the subspace topology induced by the Zariski topology on~$X$.
\end{definition}


\begin{remark}
  A subset~$X \subseteq \Aff^n$ is a {\qaffine} set if and only if it is of the form~$X = C \cap U$ for some Zariski closed subset~$C \subseteq \Aff^n$ and Zariski open subset~$U \subseteq \Aff^n$.
\end{remark}


\begin{corollary}
  Let~$X, X_1, \dotsc, X_n \subseteq \Aff^n$ be {\qaffine} sets.
  \begin{enumerate}
    \item
      Every Zariski open subsets of~$X$ is again a {\qaffine} set.
    \item
      Every Zariski closed subsets of~$X$ is again a {\qaffine} set.
    \item
      The finite intersection~$X_1 \cap \dotsb \cap X_n$ is again a {\qaffine} set.
  \end{enumerate}
\end{corollary}


\begin{proof}
  Let~$C, C_1, \dotsc, C_n \subseteq \Aff^n$ be Zariski closed and~$U, U_1, \dotsc, U_n \subseteq \Aff^n$ Zariski open such that~$X = C \cap U$ and~$X_i = C_i \cap U_i$ for every~$i$.
  \begin{enumerate}
    \item
      If~$V \subseteq X$ is Zariski open then there exists a Zariski open subset~$V' \subseteq \Aff^n$ with~$V = V' \cap X$.
      It then follows that
      \[
          V
        = V' \cap X
        = V' \cap C \cap U
        = C \cap (V' \cap U)
      \]
      with~$V' \cap U \subseteq \Aff^n$ being Zariski open.
    \item
      This can be shown in the same way as above.
    \item
      It follows that
      \[
          X_1 \cap \dotsb \cap X_n
        = (C_1 \cap \dotsb \cap C_n) \cap (U_1 \cap \dotsb \cap U_n)
      \]
      with~$C_1 \cap \dotsb \cap C_n \subseteq \Aff^n$ being Zariski closed and~$U_1 \cap \dotsb \cap U_n \subseteq \Aff^n$ being Zariski open.
    \qedhere
  \end{enumerate}
\end{proof}


\begin{example}
  \leavevmode
  \begin{enumerate}
    \item
      Every affine set is a {\qaffine} set.
    \item
      If~$X$ is an affine set then~$\Dopen_X(f)$ is a {\qaffine} set for every~$f \in \coord(X)$.
    \item
      It follows from the previous example with~$X = \Aff^{n^2}$ and~$f = \det$ that~$\GL_n(k) = \Dopen(\det)$ is a {\qaffine} set.
  \end{enumerate}
\end{example}


\begin{lemma}
\label{quasi-affine have only finitely many irreducible}
  A {\qaffine} set has only finitely many irreducible components.
  \qed
\end{lemma}





\subsection{Morphisms of Quasi-Affine Sets}


\begin{definition}
  \label{regular for quasiaffine}
  Let~$X$ be a {\qaffine} set and let~$f \colon X \to k$ be a function.
  \begin{enumerate}
    \item
      The function~$f$ is \emph{regular at~$x \in X$} if~$f$ is a rational function in some neighbourhood of~$x$, i.e.\ if there exist~$U \subseteq X$ open and~$g, h \in \coord(X)$ such that~$x \in U$,~$h(y) \neq 0$ for every~$y \in U$ and~$f(y) = g(y)/h(y)$ for all~$y \in U$.
    \item
      The function~$f$ is \emph{regular} if it is regular at every point~$x \in X$.
      The set of all rational functions~$X \to k$ is denoted by~$\rational(X)$.
  \end{enumerate}
\end{definition}


\begin{notation}
  If~$X$ is a set,~$U \subseteq X$ is a subset and~$f, f', g, g' \colon X \to k$ are functions with~$g(x), g'(x) \neq 0$ for every~$x \in U$ and~$f(x)/g(x) = f'(x)/g'(x)$ for all~$x \in U$ then we say that~$f/g \equiv f'/g'$~on~$U$.
\end{notation}


\begin{proposition}
  \label{regular on affine is polynomial}
  Let~$X$ be an affine set and let~$f \colon X \to k$ be a regular function in the sense of \cref{regular for quasiaffine}.
  The map~$f$ is then already a polynomial, and thus regular in the sense of \cref{regular for affine}.
  Thus both definitions agree for affine sets, and~$\rational(X) = \coord(X)$.
\end{proposition}


\begin{proof}
  There exists an open cover~$(U_i)_{i \in I}$ of~$X$ such that~$f$ is given on each~$U_i$ by a rational function~$f_i/g_i$ for suitable~$f_i, g_i \in \coord(X)$.
  We may assume that each~$U_i$ is of the form~$U_i = \Dopen(h_i)$ for some~$h_i \in \coord(X)$ as these sets form a basis for the Zariski topology on~$X$.
  
  It follows for all~$i,j \in I$ that~$f_i/g_i \equiv f_j/g_j$ on~$U_i \cap U_j$, and therefore that~$f_i g_j \equiv f_j g_i$ on~$U_i \cap U_j$.
  The set~$U_i \cap U_j$ is given by
  \[
    U_i \cap U_j = \Dopen(h_i) \cap \Dopen(h_j) = \Dopen(h_i h_j) \,.
  \]
  It follows that by multiplying the above equality with~$h_i h_j$ we arrive at the equality
  \begin{equation}
  \label{extended equality on intersections}
      h_i h_j f_i g_j
    = h_i h_j f_j g_i \,,
  \end{equation}
  which holds both on~$U_i \cap U_j = \Dopen(h_i hj)$ and on~$X \setminus (U_i \cap U_j) = \vset(h_i h_j)$, i.e.\ on the whole of~$X$.
  
  We may assume that~$h_i = g_i$:
  It holds that~$\Dopen(h_i) \subseteq \Dopen(g_i)$ because the rational function~$f_i/g_i$ is defined on~$U_i = \Dopen(h_i)$.
  It follows from \cref{containment of D} that~$h_i \in \rad{\genideal{g_i}}$ and therefore that~$h_i^n = a g_i$ for some~$a \in \coord(X)$,~$n \geq 0$.
  It follows that~$a(x) \neq 0$ forevery~$x \in U_i = \Dopen(h_i)$ and therefore 
  \[
            \frac{f_i}{g_i}
    \equiv  \frac{a f_i}{a g_i}
    \equiv   \frac{a f_i}{h_i^n}
  \]
  on~$U_i$.
  By replacing~$f_i$ with~$a f_i$ and both~$g_i$ and~$h_i$ with~$h_i^n$ the claim follows.
  Note that \Cref{extended equality on intersections} can now be rewritten as
  \begin{equation}
  \label{equality on intersections}
        f_i g_j \cdot g_i g_j
      = f_j g_i \cdot g_i g_j \,.
  \end{equation}
  So we may swap the indices in the term~$f_i g_j$ if the factor~$g_i g_j$ is present.
  
  The denominators~$g_i$,~$i \in I$ have no common zeros because
  \[
              \vset(g_i \suchthat i \in I)
    =         \bigcap_{i \in I} \vset(g_i)
    =         X \setminus \bigcup_{i \in I} \Dopen(g_i)
    =         X \setminus X
    =         \emptyset \,,
  \]
  The squares~$g_i^2$,~$i \in I$ do therefore also have no common zeroes (because~$g_i$ and~$g_i^2$ have the same zeroes).
  It follows from \hyperref[nullstellensatz 2]{Hilbert’s~Nullstellensatz} that there exists a linear combination
  \begin{equation}
  \label{unit as linear combination}
      1
    = \sum_{i \in I} a_i g_i^2
  \end{equation}
  for suitable~$a_i \in \coord(X)$.
  By using \Cref{equality on intersections} and \Cref{unit as linear combination} it follows that it holds on~$U_j$ that
  \[
            f
    \equiv  \frac{f_j}{g_j}
    \equiv  \frac{f_j}{g_j} \sum_{i \in I} a_i g_i^2
    \equiv  \sum_{i \in I} \frac{a_i f_j g_i^2}{g_j}
    \equiv  \sum_{i \in I} \frac{a_i f_j g_i^2 g_j}{g_j^2}
    \equiv  \sum_{i \in I} \frac{a_i f_i g_j^2 g_i}{g_j^2}
    \equiv  \sum_{i \in I} a_i f_i g_i \,.
  \]
  This shows that~$f \equiv \sum_{i \in I} a_i f_i g_i$ on~$U_j$ for every~$j \in I$ and therefore~$f = \sum_{i \in I} a_i f_i g_i$.
\end{proof}


% TODO: Understand this proof better.


\begin{definition}
  \label{regular of qaffine}
  Let~$X,Y$ be {\qaffine} sets.
  \begin{enumerate}[resume]
    \item
      A map~$f \colon X \to \Aff^m$ is \emph{regular} if it is regular in each coordinate.
    \item
      A map~$f \colon X \to Y$ is \emph{regular} if it is the restriction of a regular map~$X \to \Aff^m$.
  \end{enumerate}
  A map~$X \to Y$ is a \emph{morphism} of {\qaffine} sets if it is regular.
\end{definition}


\begin{remark}
  \Cref{regular on affine is polynomial} shows that \cref{regular of qaffine} agrees with \cref{regular for affine} for affine sets.
\end{remark}


\begin{lemma}
  Let~$X \subseteq X' \subseteq \Aff^n$ be a {\qaffine} set with~$X'$ an affine set.
  \begin{enumerate}
    \item
      The sets~$\Dopen_X(f)$ with~$f \in \coord(X')$ are a basis of the Zariski topology on~$X$.
    \item
      The sets~$\Dopen_X(f)$ with~$f \in \rational(X)$ are open in~$X$, and also form a basis of the Zariski topology on~$X$.
  \end{enumerate}
\end{lemma}


\begin{proof}
  \leavevmode
  \begin{enumerate}
    \item
      This follows from the fact that the sets~$\Dopen_{X'}(f)$ with~$f \in \coord(X')$ are a basis for the Zariski topology on~$X'$ and that~$\Dopen_X(f) = \Dopen_{X'}(f) \cap X$ for every~$f \in \coord(X)$.
    \item
      It remains to show that every~$f \in \rational(X)$ is continuous.
      If~$f$ is a globally defined rational function given by~$f = g/h$ for~$f, g \in \Aff(X')$ then~$\Dopen_X(f) = \Dopen_X(g)$ is open.
      
      If more generally~$f$ is regular then there exists an open cover~$(U_i)_{i \in I}$ of~$X$ such that~$\restrict{f}{U_i}$ is rational for every~$i \in I$.
      It then follows by the above that~$\restrict{f}{U_i}$ is continuous for every~$i \in I$ (where we use that~$U_i$ is again {\qaffine} and~$\restrict{f}{U_i}$ is again regular) and therefore that~$f$ is continuous (because continuity is a local property).
    \qedhere
  \end{enumerate}
\end{proof}


\begin{corollary}
  Let~$X,Y$ be {\qaffine} sets and let~$f \colon X \to Y$ be a morphism of {\qaffine} sets.
\ \begin{enumerate}
    \item
      It holds for every~$\varphi \in \rational(Y)$ that~$f^{-1}(\Dopen_Y(\varphi)) = \Dopen_X(\varphi \circ f)$.
    \item
      The map~$f$ is continuous with respect to the Zariski topologies on~$X,Y$.
    \qed
  \end{enumerate}
\end{corollary}


\begin{lemma}
  Let~$X, Y, Z$ be {\qaffine} sets.
  \begin{enumerate}
    \item
      The identity map~$\id_X \colon X \to X$ is a morphism.
    \item
      For every two morphisms~$f \colon X \to Y$ and~$g \colon Y \to Z$ their composition~$g \circ f \colon X \to Z$ is again a morphism.
  \end{enumerate}
\end{lemma}


\begin{proof}
  \leavevmode
  \begin{enumerate}[start=2]
    \item
      We need to show that~$g \circ f$ is regular at every point~$x \in X$.
      It follows from the regularity of~$g$ that there exists an open neighbourhood~$V \subseteq Y$ of~$f(x)$ on which~$g$ is given by a rational function~$g_1/g_2$.
      It follows from the continuity of~$f$ that there exists an open neighbourhood~$U$ of~$x$ with~$f(U) \subseteq V$.
      By using the regularity of~$f$ and shrinkening~$V$ if necessary we may assume that~$f$ is given by a rational function~$f_1/f_2$ on~$U$.
      It then follows that
      \[
          (g \circ f)(x)
        = \frac{ g_1\left( \frac{f_1(x)}{f_2(x)} \right) }{ g_2\left( \frac{f_1(x)}{f_2(x)} \right) }
      \]
      for every~$x \in U$, which shows that~$g \circ f$ is given by a rational function on~$U$.
      (Recall that the composition of rational functions is again rational.)
    \qedhere
  \end{enumerate}
\end{proof}



\begin{lemma}
  Let~$X, Y, Z$ be {\qaffine} sets
  \begin{enumerate}
    \item
      If~$f \colon X \to Y$ is a morphism of {\qaffine} sets then the map
      \[
                  f^*
        \colon    \rational(Y)
        \to       \rational(X),
        \quad     \varphi
        \mapsto   \varphi \circ f
      \]
      is a homomorphism of~\dash{$k$}{algebras}.
    \item
      It holds that~$\id_X^* = \id_{\rational(X)}$.
    \item
      If~$f \colon X \to Y$,~$g \colon Y \to Z$ are morphisms of {\qaffine} sets then~$(g \circ f)^* = f^* \circ g^*$.
    \qed
  \end{enumerate}
\end{lemma}




\subsection{Products of Quasi-Affine Sets}


\begin{lemma}
  If~$X \subseteq \Aff^n$ and~$Y \subseteq \Aff^m$ are {\qaffine} sets then the set~$X \times Y \subseteq \Aff^{n+m}$ is again {\qaffine}.
\end{lemma}


\begin{proof}
  Let~$X' \subseteq \Aff^n$ and~$Y' \subseteq \Aff^m$ be affine sets such that~$X \subseteq X'$ and~$Y \subseteq Y'$ are open subsets.
  Then~$X \times Y$ is an open subset of the affine set~$X' \times Y' \subseteq \Aff^{n+m}$ because the Zariski topology on~$X' \times Y'$ is finer than the product topology.
\end{proof}



\begin{definition}
  For {\qaffine} sets~$X \subseteq \Aff^n$,~$Y \subseteq \Aff^m$ their \emph{product} is the {\qaffine} set~$X \times Y \subseteq \Aff^{n+m}$.
\end{definition}


\begin{fluff}
  Note that for affine sets~$X, Y$ their product as affine sets is the same as their product of {\qaffine} sets.
  We therefore do not need to specify which kind of product of we are talking about when dealing with affine sets.
\end{fluff}


\begin{lemma}
  Let~$X, X_1, X_2, X_2, Y_1, Y_2$ be {\qaffine} sets.
  \begin{enumerate}
    \item
      The projections~$\pi_i \colon X_1 \times X_2 \to X_i$ are morphisms of {\qaffine} sets.
    \item
      A map~$f \colon X \to Y_1 \times Y_2$ given by~$f = (f_1, f_2)$ with~$f_i \colon X \to Y_i$ is a morphism of {\qaffine} sets if and only if both~$f_1, f_2$ are morphisms of {\qaffine} sets.
  \end{enumerate}
  This shows that the product of two {\qaffine} sets is their categorical product in the category of {\qaffine} sets.
  \begin{enumerate}[resume]
    \item
      If~$f \colon X \to X'$ and~$g \colon Y \to Y'$ are to morphisms of {\qaffine} sets then the induced map~$f \times g \colon X \times Y \to X' \times Y'$ is again a morphism of {\qaffine} sets.
    \qed
  \end{enumerate}
\end{lemma}





\subsection{Affine Varieties}


\begin{definition}
  An \emph{affine~variety} is a {\qaffine} set which is isomorphic to an affine set (as a {\qaffine} set).
  A \emph{{\qaffine}~variety} is just a {\qaffine} set.
  A \emph{morphism} of (quasi-)affine varieties is just a morphism of {\qaffine} sets.% this comment makes footnote not notice this line break
  \footnote{We will later on extend this notions to projective and {\qprojective} sets.}
\end{definition}


\begin{notation}
  For an affine variety~$X$ we often write~$\coord(X) \defined \rational(X)$.
  \Cref{regular on affine is polynomial} shows that this is well-defined when~$X$ is an affine set.
\end{notation}


\begin{remark}
  Many authors additionally require affine varieties to be irreducible.
  The author tries to avoid this restriction.
\end{remark}


\begin{example}
\label{principal open sets of affine are again affine}
  \leavevmode
  \begin{enumerate}
    \item
      Every affine set is an affine variety.
    \item
      Let~$X$ be an affine variety and let~$f \in \coord(X)$.
      Then the open subset~$\Dopen_X(f)$ is again an affine variety:
      
      We may assume that~$X \subseteq \Aff^n$ is an affine set.
      For the set
      \[
          Y
        = \left\{
                (x, t)
            \in \Aff^n \times \Aff^1
            =   \Aff^{n+1}
          \suchthat*
            x \in X,
            x t = 1
          \right\}
      \]
      the map
      \[
                \varphi
        \colon  \Dopen_X(f)
        \to     Y,
        \quad   x
        \mapsto \left( x, \frac{1}{f(x)} \right)
      \]
      is a bijection.
      If~$X$ is cut out by some ideal~$I \idealleq k[x_1, \dotsc, x_n]$ then~$Y$ is cut out by the ideal~$I$ together with the polynomial~$f x_{n+1} - 1$, which shows that~$Y$ is again an affine set.
      The map~$\varphi$ is rational in each coordinate and therefore a morphism.
      The inverse of~$\varphi$ is given by projection onto the first~$n$-th coordinates, which is also a morphism.
      This shows that~$\varphi$ is an isomorphism, which shows that claim.
      
      It follows in particular that the isomorphism~$\varphi$ of affine varieties induces an isomorphism of \dash{$k$}{algebras}~$\varphi^* \colon \coord(Y) \to \coord(\Dopen_X(f))$.
      It follows that
      \begin{align*}
                \coord(\Dopen_X(f))
        &\cong  \coord(Y) \\
        &=      k[x_1, \dotsc, x_n, x_{n+1}]/(I, f x_{n+1} - 1) \\
        &\cong  ( k[x_1, \dotsc, x_n]/I )[x_{n+1}]/(f x_{n+1} - 1) \\
        &=      \coord(X)[x_{n+1}]/(f x_{n+1} - 1) \\
        &\cong  \coord(X)[f^{-1}]
      \end{align*}
      is the localization of~$\coord(X)$ at~$f$.
      This shows that every regular function on~$\Dopen_X(f)$ is of the form~$g/f^n$ for some~$g \in \coord(X)$ and~$n \geq 0$.
    \item
      As an instance of the previous example we find that~$\GL_n(k) = \Dopen(\det) \subseteq \Aff^{n^2}$ is an affine variety with
      \[
          \coord(\GL_n(k))
        = \coord\left( \Aff^{n^2} \right)\left[ {\det}^{-1} \right]
        = k\left[ x_{11}, \dotsc, x_{nn}, {\det}^{-1} \right] \,.
      \]
      As an example we have for~$n = 2$ that
      \[
          \coord(\GL_2(k))
        = k\left[a, b, c, d, \frac{1}{ad-bc}\right] \,.
      \]
  \end{enumerate}
\end{example}


\begin{lemma}
  Let~$X, X_1, X_2$ be affine varieties.
  \begin{enumerate}
    \item
      Every closed subset~$C \subseteq X$ is again an affine variety.
    \item
      If~$X_1$ and~$X_2$ are both affine 
  \end{enumerate}
\end{lemma}


\begin{lemma}
  \label{closed of affine is again affine}
  Every Zariski closed subset of an affine variety is again an affine variety.
\end{lemma}


\begin{proof}
  Let~$X$ be an affine variety and let~$Y \subseteq X$ be Zariski closed.
  Then there exists an affine set~$X' \subseteq \Aff^n$ and an isomorphism~$\varphi \colon X \to X'$.
  The set~$Y' \defined \varphi(X')$ is Zariski closed in~$X'$ because~$\varphi$ is a homeomorphism, and it follows that~$Y' \subseteq \Aff^n$ is an affine set.
  The isomorphism~$\varphi \colon X \to X'$ restricts to an isomorphism~$Y \to Y'$, showing that~$Y$ is an affine variety.
\end{proof}


\begin{lemma}
  \label{equivalence for affine varieties}
  The coordinate ring~$\coord(-)$ gives rise to a contravariant equivalence
  \begin{align*}
    \{
      \text{affine varieties}
    \}
    &\longto
    \left\{
      \begin{tabular}{@{}c@{}}
        finitely generated, \\
        commutative,        \\
        reduced~\dash{$k$}{algebras}
      \end{tabular}
    \right\} \,,
    \\
    X
    &\longmapsto
    \coord(X) \,,
    \\
    f
    &\longmapsto
    f^* \,.
  \end{align*}
\end{lemma}


\begin{proof}
  This follows from \cref{equivalence for affine sets}.
\end{proof}


% TODO: Show that A^n - 0 is quasi-affine but not affine.


\begin{lemma}
  \label{coordinate ring of product of qaffine}
  For affine varieties~$X,Y$ the map
  \[
            \coord(X) \tensor_k \coord(Y)
    \to     \coord(X \times Y) \,,
    \quad   f \tensor g
    \mapsto [(x, y) \mapsto f(x) g(y)]
  \]
  is a \dash{well}{defined} natural isomorphism of~\dash{$k$}{algebras}.
\end{lemma}


\begin{proof}
  To see that the proposed map~$\Phi = \Phi_{X,Y}$ is \dash{well}{defined} let~$f \in \coord(X)$ and~$g \in \coord(Y)$.
  We need to show that~$\Phi(f \tensor g)$ is regular at every point~$(x,y) \in X \times Y$.
  There exist a neighbourhood~$U \subseteq X$ of~$x$ on which~$f$ is given by a rational function~$f_1/f_2$, and similarly a neighbourhood~$V \subseteq Y$ of~$y$ on which~$g$ is given by a rational function~$g_1/g_2$.
  It follows that~$U \times V$ is an open neighbourhood of~$(x,y)$ in~$X \times Y$ because the Zariski topology on~$X \times Y$ is finer than the product topology.
  In this neighbourhood the map~$\Phi(f \tensor g)$ is given by the rational function~$(f_1 g_1) / (f_2 g_2)$.
  This shows that~$\Phi(f \tensor g)$ is regular at~$(x,y)$.
  
  To show that naturality of~$\Phi$ let~$X', Y'$ be another pair of affine varieties and consider a pair of morphisms~$\varphi \colon X \to X'$,~$\psi \colon Y \to Y'$.
  For the naturialty of~$\Phi$ we need the diagram
  \begin{equation}
  \label{naturality for product of coordinate rings}
    \begin{tikzcd}[sep = large]
        \coord(X) \tensor_k \coord(Y)
        \arrow{r}[above]{\Phi_{X,Y}}
      & \coord(X \times Y)
      \\
        \coord(X') \tensor_k \coord(Y')
        \arrow{u}[left]{\varphi^* \tensor \psi^*}
        \arrow{r}[above]{\Phi_{X',Y'}}
      & \coord(X' \times Y')
        \arrow{u}[right]{(\varphi \times \psi)^*}
    \end{tikzcd}
  \end{equation}
  to commutes.
  This holds because
  \begin{align*}
        \Phi_{X,Y}( (\varphi^* \times \psi^*)(f \tensor g) )(x,y)
    &=  \Phi_{X,Y}( \varphi^*(f) \tensor \psi^*(g) )(x,y)         \\
    &=  \varphi^*(f)(x) \psi^*(g)(y)                              \\
    &=  (f \circ \varphi)(x) (g \circ \psi)(y)                    \\
    &=  f(\varphi(x)) g(\psi(y))                                  \\
    &=  \Phi_{X',Y'}(f \tensor g)(\varphi(x), \psi(y))            \\
    &=  \Phi_{X',Y'}(f \tensor g)( (\varphi \times \psi)(x,y) )   \\
    &=  (\varphi \times \psi)^*( \Phi_{X',Y'}(f \tensor g) )(x,y)
  \end{align*}
  for all~$(x,y) \in X \times Y$, and therefore
  \[
      \Phi_{X,Y}( (\varphi^* \tensor \psi^*)(f \tensor g) )
    = (\varphi \times \psi)^*( \Phi_{X',Y'}(f \tensor g ) )
  \]
  for every simple tensor~$f \tensor g \in \coord(X') \tensor \coord(Y')$, and thus overall
  \[
      \Phi_{X,Y} \circ (\varphi^* \tensor \psi^*)
    = (\varphi \times \psi)^* \circ \Phi_{X',Y'} \,.
  \]

  
  To show that~$\Phi$ is an isomorphism let~$X' \subseteq \Aff^n$ and~$Y' \subseteq \Aff^m$ be affine sets for which there exists isomorphisms~$\varphi \colon X \to X'$ and~$\psi \colon Y \to Y'$.
  Then in the resulting commutative diagram~\eqref{naturality for product of coordinate rings} the vertical arrows are both isomorphisms and the lower horizontial map~$\Phi_{X', Y'}$ is an isomorphism by~\Cref{coordinate ring of product of affine sets}.
  It follows that the upper horizontal arrow, which can be expressed as
  \begin{equation}
  \label{isomorphism for affine varieties}
      \Phi_{X,Y}
    = (\varphi \times \psi)^* \circ \Phi_{X',Y'} \circ ( \varphi^* \tensor \psi^* )^{-1} \,,
  \end{equation}
  is also an isomomorphism.
\end{proof}


\begin{remark}
  That~$\Phi_{X,Y}$ is well-defined for affine varieties~$X,Y$ also follows from~\Cref{isomorphism for affine varieties}.
  The above argumentation actually shows that~$\Phi_{X,Y}$ is well-defined whenever~$X,Y$ are {\qaffine} varietes, and it is explained in~\cite{MO267198} that~$\Phi_{X,Y}$ is then again an isomorphism.
  (One uses that that the isomorphism holds for affine varieties, and then uses that {\qaffine} varities are \enquote{locally affine} and that regularity is a local condition.)
% TODO: Add a proper explanation how and why quasi-affine varietes are locally affine.
\end{remark}


\begin{remark}
  Just as we can generalize \cref{equivalence for affine sets} to \cref{equivalence for affine varieties} and \cref{coordinate ring of product of affine sets} to \cref{coordinate ring of product of qaffine} we can generalize most of our previous results about affine sets from \cref{affine sets} to affine varieties, as these are just affine sets up to isomorphism.
  We will not do this explicitely for every such result but instead also refer to the result about affine sets even when we are using the generalized result about affine varieties.
\end{remark}


\begin{fluff}
  The notion of {\qaffine} sets and the above generalization of affine sets to affine varieties were originally not given in the lecture.
  {\Qaffine} sets were only introduced much later on together with projective and {\qprojective} sets.
  We have choosen to include these concept earlier on so that~$\GL_n(k)$ becomes an affine variety.
  This places the upcoming discussion of affine algebraic groups on a more formally solid foundation.
  
  The idea of using~{\qaffine} sets and the regular maps between them was inspired by~\cite[2.2]{frankeAlg1}.
  The proof of \cref{regular on affine is polynomial} is taken from~\cite[Lemma~3.10]{milneAG}.
\end{fluff}







